<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>√Ålbum de Recuerdos</title>
<style>
:root {
  --main-color: #2ecc71;
}

body {
  font-family: 'Poppins', sans-serif;
  background-color: #f8f8f8;
  margin: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
}

h1 {
  color: var(--main-color);
  margin: 20px;
  font-weight: 600;
}

#gallery {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 10px;
  width: 95%;
  max-width: 900px;
}

img, video {
  width: 100%;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

#uploadBtn {
  background-color: var(--main-color);
  color: white;
  border: none;
  padding: 12px 25px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 1rem;
  margin: 20px 0;
}
</style>
</head>
<body>
  <h1>√Ålbum de Recuerdos üíö</h1>

  <input type="file" id="fileInput" accept="image/*,video/*" hidden>
  <button id="uploadBtn">‚ûï Agregar Recuerdo</button>

  <div id="gallery"></div>

  <script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbwbl3sF6hZh68C-MugCNIy2-Sv95LAPAfCyGIAzkI7pJUPpaHQKnVIGJMh-XoZZBdEA-A/exec'; // tu URL del App Script publicado
  const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ2OKzdNbfLoqWpJQet5zoExBcOfF7nKaIXh4JYK6KplbYSIUJFe6J0hR8trAYq1tGeSFFAVwDDRKrF/pub?output=csv';

  const fileInput = document.getElementById('fileInput');
  const uploadBtn = document.getElementById('uploadBtn');
  const gallery = document.getElementById('gallery');

  uploadBtn.addEventListener('click', () => fileInput.click());

  fileInput.addEventListener('change', async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    uploadBtn.disabled = true;
    uploadBtn.textContent = 'Subiendo...';

    // Convertir a base64 para enviarlo
    const base64 = await toBase64(file);

    const res = await fetch(scriptURL, {
      method: 'POST',
      headers: { 'Content-Type': file.type },
      body: base64
    });
    const data = await res.json();

    uploadBtn.disabled = false;
    uploadBtn.textContent = '‚ûï Agregar Recuerdo';

    if (data.status === 'success') {
      showFile(data.url);
    } else {
      alert('Error: ' + data.message);
    }
  });

  async function loadGallery() {
    try {
      const response = await fetch(sheetURL);
      const text = await response.text();
      const urls = text.match(/https?:\/\/[^\s"]+/g);
      if (!urls) return;
      urls.forEach(url => showFile(url));
    } catch (err) {
      console.error('Error cargando galer√≠a', err);
    }
  }

  function showFile(url) {
    const lower = url.toLowerCase();
    const element = lower.endsWith('.mp4') ? document.createElement('video') : document.createElement('img');
    element.src = url;
    if (element.tagName === 'VIDEO') element.controls = true;
    gallery.prepend(element);
  }

  function toBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      reader.onload = () => resolve(reader.result.split(',')[1]);
      reader.onerror = reject;
    });
  }

  loadGallery();
  </script>
</body>
</html>
